<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>SocialNetworkCircleVisual.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">CircularOrbitHelper (1) (May 19, 2019 10:19:54 PM)</a> &gt; <a href="../../index.html" class="el_group">Lab4-1170300316</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">APIs</a> &gt; <span class="el_source">SocialNetworkCircleVisual.java</span></div><h1>SocialNetworkCircleVisual.java</h1><pre class="source lang-java linenums">package APIs;

import static org.junit.Assert.assertTrue;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.EventQueue;
import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;

import Log.LogFile;

import javax.swing.JLabel;
import javax.swing.ImageIcon;

import java.awt.EventQueue;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.io.UnsupportedEncodingException;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.swing.JFrame;

import centralObject.CentralObject;
import centralObject.Nucleus;
import centralObject.Person;
import circularOrbit.CircularOrbit;
import exception.FalseDependencyException;
import exception.IllegalNumberException;
import exception.MissingObjectException;
import exception.SameLabelException;
import physicalObject.Atom;
import physicalObject.Friend;
import physicalObject.Planet;
import track.Track;
import extensions.FriendRelation;
import extensions.Graph;
import javax.swing.JComboBox;
import javax.swing.JButton;
import javax.swing.JTextPane;

public class SocialNetworkCircleVisual extends JFrame {

<span class="fc" id="L60">	private static CircularOrbit&lt;CentralObject, Track&gt; orbit = CircularOrbit.emptySocialNetworkCircle();</span>
<span class="fc" id="L61">	private static Set&lt;Friend&gt; set = new HashSet&lt;Friend&gt;();</span>
<span class="fc" id="L62">	private static Graph&lt;Friend&gt; graph = Graph.empty(set);</span>

<span class="fc" id="L64">	static FriendRelation relation = new FriendRelation(orbit.GetFriends());</span>
<span class="fc" id="L65">	static Set&lt;Friend&gt; addedFriends = new HashSet&lt;Friend&gt;();</span>

	private JPanel contentPane;

	/**
	 * Launch the application.
	 * @throws IOException 
	 */
	public static void main(String[] args) throws IOException {

<span class="fc" id="L75">		Parse();</span>

<span class="fc" id="L77">		EventQueue.invokeLater(new Runnable() {</span>
			public void run() {
				try {
<span class="fc" id="L80">					SocialNetworkCircleVisual frame = new SocialNetworkCircleVisual();</span>
<span class="fc" id="L81">					frame.setVisible(true);</span>
<span class="pc" id="L82">				} catch (Exception e) {</span>
<span class="nc" id="L83">					e.printStackTrace();</span>
				}
<span class="fc" id="L85">			}</span>
		});
<span class="fc" id="L87">	}</span>

	/**
	 * Create the frame.
	 */
<span class="fc" id="L92">	public SocialNetworkCircleVisual() {</span>
<span class="fc" id="L93">		setTitle(&quot;Social Network&quot;);</span>
<span class="fc" id="L94">		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L95">		setBounds(100, 100, 960, 640);</span>
<span class="fc" id="L96">		contentPane = new JPanel();</span>
<span class="fc" id="L97">		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));</span>
<span class="fc" id="L98">		setContentPane(contentPane);</span>
<span class="fc" id="L99">		contentPane.setLayout(null);</span>

<span class="fc" id="L101">		orbit.Init(contentPane);</span>

<span class="fc" id="L103">		JLabel lblNewLabel = new JLabel(&quot;New label&quot;);</span>
<span class="fc" id="L104">		lblNewLabel.setIcon(new ImageIcon(&quot;lib/SocialNetwork/human.png&quot;));</span>
<span class="fc" id="L105">		lblNewLabel.setBounds(450, 290, 60, 60);</span>
<span class="fc" id="L106">		contentPane.add(lblNewLabel);</span>

<span class="fc" id="L108">		JComboBox comboBox = new JComboBox();</span>
<span class="fc" id="L109">		comboBox.setBounds(30, 28, 120, 27);</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">		for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc" id="L111">			comboBox.addItem(friend.GetName());</span>
		}
<span class="fc" id="L113">		contentPane.add(comboBox);</span>

<span class="fc" id="L115">		JTextPane textPane = new JTextPane();</span>
<span class="fc" id="L116">		textPane.setBounds(30, 108, 120, 16);</span>
<span class="fc" id="L117">		contentPane.add(textPane);</span>

<span class="fc" id="L119">		JButton btnNewButton = new JButton(&quot;Info Diffusion&quot;);</span>

<span class="fc" id="L121">		btnNewButton.setBounds(30, 67, 117, 29);</span>

<span class="fc" id="L123">		btnNewButton.addActionListener(new ActionListener() {</span>
<span class="fc" id="L124">			int infoDiffusion = 0;</span>

			public void actionPerformed(ActionEvent e) {
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">				for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">					if (friend.GetName().equals(comboBox.getSelectedItem())) {</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">						for (Friend friend2 : orbit.GetFriends()) {</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">							if (relation.isRelated(friend, friend2)) {</span>
<span class="nc" id="L131">								infoDiffusion++;</span>
							}
						}
					}
				}
<span class="nc" id="L136">				textPane.setText(String.valueOf(infoDiffusion));</span>
<span class="nc" id="L137">				infoDiffusion = -1;</span>
<span class="nc" id="L138">			}</span>
		});

<span class="fc" id="L141">		contentPane.add(btnNewButton);</span>

<span class="fc" id="L143">		JComboBox comboBox_1 = new JComboBox();</span>
<span class="fc" id="L144">		comboBox_1.setBounds(30, 163, 120, 27);</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">		for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc" id="L146">			comboBox_1.addItem(friend.GetName());</span>
		}
<span class="fc" id="L148">		contentPane.add(comboBox_1);</span>

<span class="fc" id="L150">		JComboBox comboBox_2 = new JComboBox();</span>
<span class="fc" id="L151">		comboBox_2.setBounds(30, 202, 120, 27);</span>
<span class="fc bfc" id="L152" title="All 2 branches covered.">		for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc" id="L153">			comboBox_2.addItem(friend.GetName());</span>
		}
<span class="fc" id="L155">		contentPane.add(comboBox_2);</span>

<span class="fc" id="L157">		JButton btnNewButton_1 = new JButton(&quot;Add Relation&quot;);</span>
<span class="fc" id="L158">		btnNewButton_1.setBounds(30, 241, 117, 29);</span>
<span class="fc" id="L159">		contentPane.add(btnNewButton_1);</span>

<span class="fc" id="L161">		btnNewButton_1.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent e) {
<span class="fc bfc" id="L163" title="All 2 branches covered.">				for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">					if (friend.GetName().equals(comboBox_1.getSelectedItem())) {</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">						for (Friend friend2 : orbit.GetFriends()) {</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">							if (friend2.GetName().equals(comboBox_2.getSelectedItem())) {</span>
<span class="fc" id="L167">								contentPane.removeAll();</span>
<span class="fc" id="L168">								relation.addRelation(friend, friend2);</span>

<span class="fc" id="L170">								FileWriter fw = null;</span>
								try {
									// 如果文件存在，则追加内容；如果文件不存在，则创建文件
<span class="fc" id="L173">									File f = new File(&quot;src/input/SocialNetworkCircle.txt&quot;);</span>
<span class="fc" id="L174">									fw = new FileWriter(f, true);</span>
<span class="pc" id="L175">								} catch (IOException e1) {</span>
<span class="nc" id="L176">									e1.printStackTrace();</span>
								}
<span class="fc" id="L178">								PrintWriter pw = new PrintWriter(fw);</span>
<span class="fc" id="L179">								pw.println(</span>
<span class="fc" id="L180">										&quot;\nSocialTie ::= &lt;&quot; + friend.GetName() + &quot;, &quot; + friend2.GetName() + &quot;, 0.99&gt;&quot;);</span>
<span class="fc" id="L181">								pw.flush();</span>
								try {
<span class="fc" id="L183">									fw.flush();</span>
<span class="fc" id="L184">									pw.close();</span>
<span class="fc" id="L185">									fw.close();</span>
<span class="pc" id="L186">								} catch (IOException e1) {</span>
<span class="nc" id="L187">									e1.printStackTrace();</span>
								}
								try {
<span class="fc" id="L190">									SocialNetworkCircleVisual.main(null);</span>
<span class="pc" id="L191">								} catch (IOException e1) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L193">									e1.printStackTrace();</span>
								}
<span class="fc" id="L195">								contentPane.updateUI();</span>
							}
						}
					}
				}

<span class="fc" id="L201">				contentPane.removeAll();</span>

<span class="fc" id="L203">				orbit.Init(contentPane);</span>

<span class="fc" id="L205">				contentPane.updateUI();</span>
<span class="fc" id="L206">			}</span>

		});

<span class="fc" id="L210">	}</span>

	/**
	 * Assign the reading path
	 * @throws IOException 
	 */
	public static void Parse() throws IOException {
<span class="fc" id="L217">		String file1 = &quot;src/input/SocialNetworkCircle.txt&quot;;</span>
		try {
<span class="fc" id="L219">			readFileByLines(file1);</span>
<span class="pc" id="L220">		} catch (IllegalNumberException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L222">			System.out.println(&quot;Illegal number found in the file. Please check the input file.&quot;);</span>
<span class="nc" id="L223">			LogFile.WriteError(e);</span>
<span class="nc" id="L224">			e.printStackTrace();</span>
<span class="fc" id="L225">		} catch (SameLabelException e) {</span>
			// TODO: handle exception
<span class="fc" id="L227">			System.out.println(&quot;Input file contains same planet. Please check the input file.&quot;);</span>
<span class="fc" id="L228">			LogFile.WriteError(e);</span>
<span class="fc" id="L229">			e.printStackTrace();</span>
<span class="nc" id="L230">		} catch (FalseDependencyException e) {</span>
			// TODO: handle exception
<span class="nc" id="L232">			System.out.println(&quot;Friend not found.&quot;);</span>
<span class="nc" id="L233">			LogFile.WriteError(e);</span>
<span class="nc" id="L234">			e.printStackTrace();</span>
<span class="nc" id="L235">		} catch (MissingObjectException e) {</span>
			// TODO: handle exception
<span class="nc" id="L237">			System.out.println(&quot;Object not found.&quot;);</span>
<span class="nc" id="L238">			e.printStackTrace();</span>
		}

<span class="fc" id="L241">	}</span>

	/**
	 * Read the files from .txt Build the CircularOrbit
	 * 
	 * @param fileName
	 * @throws FalseDependencyException 
	 * @throws MissingObjectException 
	 */
	private static void readFileByLines(String fileName) throws IllegalNumberException, SameLabelException, FalseDependencyException, MissingObjectException {

<span class="fc" id="L252">		BufferedReader reader = null;</span>
<span class="fc" id="L253">		BufferedReader reader2 = null;</span>

		Friend centerFriend;
		// Planet[] planet = new Planet[100];

		try {
<span class="fc" id="L259">			System.out.println(&quot;Start reading from files.&quot;);</span>
<span class="fc" id="L260">			reader = new BufferedReader(new InputStreamReader(new FileInputStream(fileName), &quot;UTF-8&quot;));</span>
<span class="fc" id="L261">			reader2 = new BufferedReader(new InputStreamReader(new FileInputStream(fileName), &quot;UTF-8&quot;));</span>
<span class="fc" id="L262">			String tempString = null;</span>
<span class="fc" id="L263">			int line = 1;</span>

			try {
<span class="fc bfc" id="L266" title="All 2 branches covered.">				while ((tempString = reader.readLine()) != null) {</span>
<span class="fc" id="L267">					String temp2 = tempString.replace(&quot; &quot;, &quot;&quot;);</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">					if (tempString.length() != 0) {</span>
<span class="fc" id="L269">						System.out.println(&quot;line &quot; + line + &quot;:&quot; + tempString);</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">						if (tempString.startsWith(&quot;CentralUser&quot;)) {</span>
<span class="fc" id="L271">							Pattern regex = Pattern.compile(&quot;&lt;(.*?),(.*?),(.*?)&gt;&quot;);</span>
<span class="fc" id="L272">							Matcher m = regex.matcher(tempString);</span>
							
							//Every param of regular expression must exist
<span class="fc" id="L275">							assertTrue(m.find());</span>
							
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">							if (m.find()) {</span>

<span class="nc bnc" id="L279" title="All 4 branches missed.">								if (Integer.valueOf(m.group(2)) &lt; 0 || m.group(2).contains(&quot;s&quot;)) {</span>
<span class="nc" id="L280">									throw new IllegalNumberException(Integer.valueOf(m.group(2)));</span>
								}

<span class="nc" id="L283">								Person person = new Person(m.group(1), Integer.valueOf(m.group(2)), m.group(3));</span>
<span class="nc" id="L284">								centerFriend = new Friend(m.group(1), Integer.valueOf(m.group(2)), m.group(3));</span>
<span class="nc" id="L285">								orbit.AddObjectToCentre(person);</span>
<span class="nc" id="L286">								orbit.NewFriend(centerFriend);</span>

<span class="nc" id="L288">								addedFriends.add(centerFriend);</span>
							}
						}

<span class="fc bfc" id="L292" title="All 2 branches covered.">						if (tempString.startsWith(&quot;Friend&quot;)) {</span>
<span class="fc" id="L293">							Pattern regex = Pattern.compile(&quot;&lt;(.*?), (.*?), (.*?)&gt;&quot;);</span>
<span class="fc" id="L294">							Matcher m = regex.matcher(tempString);</span>
							
							//Every param of regular expression must exist
							//assertTrue(m.find());
							
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">							if (m.find()) {</span>

<span class="fc bfc" id="L301" title="All 2 branches covered.">								for (Friend friend : orbit.GetFriends()) {</span>
<span class="fc bfc" id="L302" title="All 2 branches covered.">									if (friend.GetName().equals(m.group(1))) {</span>
<span class="fc" id="L303">										throw new SameLabelException(m.group(1));</span>
									}
								}

<span class="pc bpc" id="L307" title="2 of 4 branches missed.">								if (Integer.valueOf(m.group(2)) &lt; 0 || m.group(2).contains(&quot;.&quot;)) {</span>
<span class="nc" id="L308">									throw new IllegalNumberException(Integer.valueOf(m.group(2)));</span>
								}

<span class="fc" id="L311">								Friend friend = new Friend(m.group(1), Integer.valueOf(m.group(2)), m.group(3));</span>
<span class="fc" id="L312">								orbit.NewFriend(friend);</span>
							}
						}

						// ----DEBUG LOG-----//

<span class="fc" id="L318">						line++;</span>
					}
				}

<span class="fc" id="L322">				line = 1;</span>

<span class="fc bfc" id="L324" title="All 2 branches covered.">				while ((tempString = reader2.readLine()) != null) {</span>
<span class="fc" id="L325">					String temp2 = tempString.replace(&quot; &quot;, &quot;&quot;);</span>
<span class="fc bfc" id="L326" title="All 2 branches covered.">					if (tempString.length() != 0) {</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">						if (tempString.startsWith(&quot;SocialTie&quot;)) {</span>
<span class="fc" id="L328">							Pattern regex = Pattern.compile(&quot;&lt;(.*?), (.*?), (.*?)&gt;&quot;);</span>
<span class="fc" id="L329">							Matcher m = regex.matcher(tempString);</span>
							
							//Every param of regular expression must exist
<span class="fc" id="L332">							assertTrue(m.find());</span>
							
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">							if (m.find()) {</span>

<span class="nc bnc" id="L336" title="All 4 branches missed.">								if (Double.valueOf(m.group(3)) &lt;= 0 || Double.valueOf(m.group(3)) &gt; 1) {</span>
<span class="nc" id="L337">									throw new IllegalNumberException(Double.valueOf(m.group(3)));</span>
								}

<span class="nc" id="L340">								int tmp = 0;</span>

<span class="nc bnc" id="L342" title="All 2 branches missed.">								for (Friend friend : orbit.GetFriends()) {</span>
<span class="nc bnc" id="L343" title="All 4 branches missed.">									if (friend.GetName().equals(m.group(1)) || friend.GetName().equals(m.group(2))) {</span>
<span class="nc" id="L344">										tmp++;</span>
									}
								}

<span class="nc bnc" id="L348" title="All 2 branches missed.">								if (tmp != 2) {</span>
<span class="nc" id="L349">									throw new MissingObjectException(m.group(1) + &quot; &quot; + m.group(2));</span>
								}

<span class="nc bnc" id="L352" title="All 2 branches missed.">								for (Friend friend : orbit.GetFriends()) {</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">									if (friend.GetName().equals(m.group(1))) {</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">										for (Friend friend2 : orbit.GetFriends()) {</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">											if (friend2.GetName().equals(m.group(2))) {</span>
<span class="nc" id="L356">												relation.NewRelation(friend, friend2);</span>
											}
										}
									}
								}
							}
						}

						// ----DEBUG LOG-----//

<span class="fc" id="L366">						line++;</span>
					}
				}

<span class="pc bpc" id="L370" title="1 of 2 branches missed.">				for (Friend friend : relation.GetMap().keySet()) {</span>
<span class="nc" id="L371">					System.out.println(&quot;MAP &quot; + friend.GetName());</span>
<span class="nc" id="L372">					System.out.println(relation.GetMap().get(friend));</span>
				}

//				
<span class="fc" id="L376">				Track[] track = new Track[5];</span>

<span class="fc" id="L378">				int i = 0;</span>
<span class="fc" id="L379">				track[i] = new Track(i);</span>

<span class="pc bpc" id="L381" title="1 of 2 branches missed.">				for (Friend friend : addedFriends) {</span>
<span class="nc" id="L382">					track[i].AddFriendObject(friend);</span>
				}

<span class="pc bpc" id="L385" title="1 of 2 branches missed.">				for (Friend friend : track[i].GetFriendObject()) {</span>
<span class="nc" id="L386">					System.out.println(friend.GetName());</span>
				}

<span class="fc" id="L389">				orbit.AddTrack(track[i]);</span>

<span class="fc" id="L391">				i++;</span>

<span class="pc bpc" id="L393" title="1 of 2 branches missed.">				while (i &lt; 5) {</span>
<span class="fc" id="L394">					track[i] = new Track(i);</span>
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">					if (track[i - 1].GetFriendObject().size() == 0) {</span>
<span class="fc" id="L396">						break;</span>
					}
<span class="nc bnc" id="L398" title="All 2 branches missed.">					for (Friend friend : track[i - 1].GetFriendObject()) {</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">						for (Friend friend2 : orbit.GetFriends()) {</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">							if (!track[i - 1].GetFriendObject().contains(friend2)</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">									&amp;&amp; relation.isRelated(friend, friend2)) {</span>
<span class="nc" id="L402">								track[i].AddFriendObject(friend2);</span>
							}
						}
<span class="nc bnc" id="L405" title="All 2 branches missed.">						for (int j = 0; j &lt; i; j++) {</span>
<span class="nc" id="L406">							track[i].GetFriendObject().removeAll(track[j].GetFriendObject());</span>
						}
					}

<span class="nc bnc" id="L410" title="All 2 branches missed.">					for (Friend friend : track[i].GetFriendObject()) {</span>
<span class="nc" id="L411">						System.out.println(i + friend.GetName());</span>
					}
<span class="nc" id="L413">					orbit.AddTrack(track[i]);</span>
<span class="nc" id="L414">					i++;</span>
				}

<span class="nc" id="L417">			} catch (IOException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L419">				e.printStackTrace();</span>
			}

<span class="nc" id="L422">		} catch (UnsupportedEncodingException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L424">			e.printStackTrace();</span>
<span class="nc" id="L425">		} catch (FileNotFoundException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L427">			e.printStackTrace();</span>
		}
<span class="fc" id="L429">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>CircularOrbitHelper (1) (May 19, 2019 10:19:54 PM)</div></body></html>